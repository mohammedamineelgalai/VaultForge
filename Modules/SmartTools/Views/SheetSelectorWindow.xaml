<Window x:Class="XnrgyEngineeringAutomationTools.Modules.SmartTools.Views.SheetSelectorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="{DynamicResource WindowTitleSheetSelector}"
        Icon="/Resources/XnrgyEngineeringAutomationTools.ico"
        Height="720" Width="700"
        MinHeight="600" MinWidth="550"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E2E"
        ResizeMode="CanResize"
        ShowInTaskbar="True">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Styles/XnrgyStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <SolidColorBrush x:Key="XnrgyBlue" Color="#0078D4"/>
            <SolidColorBrush x:Key="XnrgyGreen" Color="#107C10"/>
            <SolidColorBrush x:Key="XnrgyOrange" Color="#FF8C00"/>
            <SolidColorBrush x:Key="XnrgyRed" Color="#E74C3C"/>
            <SolidColorBrush x:Key="DarkBg" Color="#1E1E2E"/>
            <SolidColorBrush x:Key="DarkBg2" Color="#252536"/>
            <SolidColorBrush x:Key="BorderColor" Color="#4A7FBF"/>
            <SolidColorBrush x:Key="TextLight" Color="#E0E0E0"/>
            <SolidColorBrush x:Key="ActiveSheetBg" Color="#1E3A5F"/>
            <SolidColorBrush x:Key="NpSheetBg" Color="#2D2D3D"/>
            <SolidColorBrush x:Key="DisabledBg" Color="#1A1A2A"/>
        
            <!-- Style CheckBox pour les feuilles -->
            <Style x:Key="SheetCheckBox" TargetType="CheckBox">
                <Setter Property="Foreground" Value="#E0E0E0"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Margin" Value="0"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="CheckBox">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="24"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border x:Name="checkBorder" Width="18" Height="18" Background="#252536" 
                                        BorderBrush="#4A7FBF" BorderThickness="2" CornerRadius="3">
                                    <Path x:Name="checkMark" Data="M 2,6 L 6,10 L 14,2" Stroke="White" StrokeThickness="2"
                                          Visibility="Collapsed" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Border>
                                <ContentPresenter Grid.Column="1" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="checkBorder" Property="Background" Value="#0078D4"/>
                                    <Setter TargetName="checkMark" Property="Visibility" Value="Visible"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="checkBorder" Property="Background" Value="#333"/>
                                    <Setter TargetName="checkBorder" Property="BorderBrush" Value="#555"/>
                                    <Setter Property="Foreground" Value="#666"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            
            <!-- Style Button -->
            <Style x:Key="ActionButton" TargetType="Button">
                <Setter Property="Background" Value="#0078D4"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="FontWeight" Value="Bold"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="Padding" Value="16,10"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border" Background="{TemplateBinding Background}" 
                                    CornerRadius="5" Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#1E90FF"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="border" Property="Background" Value="#555"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            
            <!-- Style RadioButton -->
            <Style x:Key="DarkRadioButton" TargetType="RadioButton">
                <Setter Property="Foreground" Value="#E0E0E0"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="Margin" Value="0,6"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2A4A6F" Padding="16,14">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="ðŸ“„" FontSize="28" VerticalAlignment="Center" Margin="0,0,12,0"/>
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock x:Name="TxtFileName" Text="--" FontSize="18" FontWeight="Bold" Foreground="White" TextTrimming="CharacterEllipsis"/>
                    <TextBlock x:Name="TxtFilePath" Text="--" FontSize="11" Foreground="#B0C4DE" TextTrimming="CharacterEllipsis" Margin="0,2,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Info Banner -->
        <Border Grid.Row="1" Background="#1E3A5F" Padding="14,10" Margin="16,12,16,0" CornerRadius="6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="â„¹ï¸" FontSize="16" VerticalAlignment="Top" Margin="0,2,10,0"/>
                <TextBlock Grid.Column="1" TextWrapping="Wrap" Foreground="#B0D4F1" FontSize="12" LineHeight="18">
                    <Run FontWeight="SemiBold" Foreground="#4FC3F7">Conseil:</Run>
                    <Run>Les feuilles sont pre-selectionnees jusqu'a la premiere feuille commencant par "NP_".</Run>
                    <LineBreak/>
                    <Run>Les feuilles marquees "Do Not Print" sont automatiquement exclues.</Run>
                </TextBlock>
            </Grid>
        </Border>

        <!-- Boutons de selection -->
        <Border Grid.Row="2" Margin="16,12,16,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button x:Name="BtnSelectAll" Content="âœ… Tout selectionner" Style="{StaticResource ActionButton}" 
                        Background="#27AE60" Width="160" Margin="0,0,12,0" Click="BtnSelectAll_Click"/>
                <Button x:Name="BtnDeselectAll" Content="â¬œ Tout deselectionner" Style="{StaticResource ActionButton}" 
                        Background="#7F8C8D" Width="170" Click="BtnDeselectAll_Click"/>
            </StackPanel>
        </Border>

        <!-- Liste des feuilles -->
        <Border Grid.Row="3" Background="#252536" CornerRadius="6" Margin="16,12,16,0" 
                BorderBrush="#4A7FBF" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- En-tete de la liste -->
                <Border Grid.Row="0" Background="#1E1E2E" Padding="12,8" CornerRadius="6,6,0,0">
                    <Grid>
                        <TextBlock Text="Feuilles du dessin" FontWeight="SemiBold" Foreground="#0078D4" FontSize="13"/>
                        <TextBlock x:Name="TxtSheetCount" Text="0 feuille(s)" HorizontalAlignment="Right" 
                                   Foreground="#888" FontSize="12"/>
                    </Grid>
                </Border>
                
                <!-- Liste scrollable -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="4">
                    <ItemsControl x:Name="SheetList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border x:Name="SheetBorder" Padding="12,10" Margin="0,2" CornerRadius="4"
                                        Background="{Binding Background}" BorderThickness="0">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <CheckBox Grid.Column="0" Style="{StaticResource SheetCheckBox}"
                                                  IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                  IsEnabled="{Binding IsAvailable}"
                                                  Content="{Binding Name}"/>
                                        
                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                            <!-- Tag Active -->
                                            <Border Visibility="{Binding ActiveTagVisibility}" 
                                                    Background="#27AE60" CornerRadius="3" Padding="8,3" Margin="4,0">
                                                <TextBlock Text="Active" Foreground="White" FontSize="11" FontWeight="SemiBold"/>
                                            </Border>
                                            <!-- Tag Do Not Print -->
                                            <Border Visibility="{Binding DoNotPrintTagVisibility}" 
                                                    Background="#E74C3C" CornerRadius="3" Padding="8,3" Margin="4,0">
                                                <TextBlock Text="Do Not Print" Foreground="White" FontSize="11" FontWeight="SemiBold"/>
                                            </Border>
                                            <!-- Tag NP_ -->
                                            <Border Visibility="{Binding NpTagVisibility}" 
                                                    Background="#9B59B6" CornerRadius="3" Padding="8,3" Margin="4,0">
                                                <TextBlock Text="NP_" Foreground="White" FontSize="11" FontWeight="SemiBold"/>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Options d'export -->
        <Border Grid.Row="4" Background="#252536" CornerRadius="6" Margin="16,12,16,0" Padding="16,12"
                BorderBrush="#4A7FBF" BorderThickness="1">
            <StackPanel>
                <TextBlock Text="Mode d'export:" FontWeight="SemiBold" Foreground="#0078D4" FontSize="13" Margin="0,0,0,8"/>
                <RadioButton x:Name="RbSingleFile" Content="ðŸ“„ Un seul fichier PDF avec toutes les feuilles selectionnees" 
                             Style="{StaticResource DarkRadioButton}" IsChecked="True" GroupName="ExportMode"/>
                <TextBlock Text="Toutes les feuilles seront combinees dans un seul document PDF." 
                           FontSize="11" Foreground="#888" Margin="24,0,0,8"/>
                <RadioButton x:Name="RbMultipleFiles" Content="ðŸ“ Un fichier PDF separe pour chaque feuille" 
                             Style="{StaticResource DarkRadioButton}" GroupName="ExportMode"/>
                <TextBlock Text="Chaque feuille sera exportee dans un fichier PDF distinct (NomFichier_NomFeuille.pdf)." 
                           FontSize="11" Foreground="#888" Margin="24,0,0,0"/>
            </StackPanel>
        </Border>

        <!-- Footer avec boutons -->
        <Border Grid.Row="5" Background="#1E1E2E" Padding="16,14" Margin="0,12,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Destination -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ“ Destination:" Foreground="#888" FontSize="12" VerticalAlignment="Center"/>
                    <TextBlock x:Name="TxtDestination" Text="6-Shop Drawing PDF" Foreground="#4FC3F7" FontSize="12" 
                               Margin="6,0,0,0" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" MaxWidth="250"/>
                </StackPanel>
                
                <Button x:Name="BtnCancel" Grid.Column="2" Content="âŒ Annuler" 
                        Style="{StaticResource ActionButton}" Background="#6B7280"
                        Width="110" Margin="0,0,12,0" Click="BtnCancel_Click"/>
                <Button x:Name="BtnExport" Grid.Column="3" Content="ðŸ“¤ Exporter PDF" 
                        Style="{StaticResource ActionButton}" Background="#107C10"
                        Width="140" Click="BtnExport_Click"/>
            </Grid>
        </Border>

        <!-- ========== COPYRIGHT BAR - Utilise styles centralises ========== -->
        <Border Grid.Row="6" Style="{DynamicResource CopyrightBarBorder}">
            <Grid>
                <TextBlock Style="{DynamicResource StatusTextStyle}" Text="Pret"/>
                <TextBlock Style="{DynamicResource CopyrightTextStyle}" HorizontalAlignment="Right"
                           Text="{DynamicResource CopyrightSheetSelector}"/>
            </Grid>
        </Border>
    </Grid>
</Window>
